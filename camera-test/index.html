<!DOCTYPE html>
<html lang="en">
<meta name="viewport" content="width=device-width, user-scalable=no">

<head>
	<meta charset="UTF-8">
	<title>Camera test</title>
	<style>
		body{
			background-color: #000;
			text-align: center;
			margin:0;
		}
		video{
			position: absolute;
			min-width: 100%;
			min-height: 100%;

			width: auto;
			height: auto;

			top: 50%;
			left: 50%;
			transform: translate(-50%,-50%);
		}
		.container{
			position: absolute;
			top: 0;
			bottom: 0;
			width: 100%;
			height: 100%;
			overflow: hidden;
		}
		.button{
			position: absolute;
			top: 85%;
			width: 100%;
			left: 0;
		}
		button#capture{
			height: 7em;
			border-radius: 8em;
			z-index: 2;
		}
		#capture-area{
			position: absolute;
			display: block;
			top: 25%;
			width: 100%;
			z-index: 1;
			text-align: center;
		}
		#capture-area .zone{
			margin: 1em auto;
			border-radius: 2em;
			border: 5px dashed red;
			max-width: 330px;
			min-height: 210px;
			width: auto;
			height: auto;
		}
		.instrucciones{
			position: absolute;
			top: 17%;
			width: 100%;
			text-align: center;
			z-index: 2;
		}
		.instrucciones p{
			font-family: Arial;
			font-size: 1em;
			color: white;
			text-shadow: -1px 2px 5px rgba(150, 150, 150, 0.85);
			margin: 2em;
		}
		#snapshot{
			margin: 3em auto;
			height: 270px;
			width: 100%;
		}
		.hidden{
			display: none;
		}
		#preview{
			color: white;
		}
		.options{
			color: #FFF;
		}
		.options button{
			background-color: white;
			margin: 2em;
		}
	</style>
</head>
<body>
	<div class="container" id="pictureContainer">
		<div class="instrucciones">
			<p>Intenta que tu credencial quede dentro del recuadro rojo</p>
		</div>
		<div id="capture-area">
			<div class="zone"></div>
		</div>
		<video id="player" autoplay></video>
		
		<div class="button">
			<button id="capture">Capturar foto</button>
		</div>
	</div>
	
	<div id="preview" class="hidden">
		<h3>Preview</h3>
		<canvas id="snapshot"></canvas>
		<div class="options">
			<button id="reintentarbtn">Reintentar</button>
		</div>
	</div>
	<script>
		var player = document.getElementById('player');
		var snapshotCanvas = document.getElementById('snapshot');
		var captureButton = document.getElementById('capture');
		var pictureContainer = document.getElementById('pictureContainer');
		var preview = document.getElementById('preview');
		var reintentarbtn = document.getElementById('reintentarbtn');

		var handleSuccess = function(stream) {
			player.srcObject = stream;
		};

		captureButton.addEventListener('click', function() {
			pictureContainer.classList.add('hidden');
			preview.classList.remove('hidden');

			var context = snapshot.getContext('2d');
			console.log(player.width)
			// Draw the video frame to the canvas.
			context.drawImage(player, 0, 0, snapshotCanvas.width, snapshotCanvas.height);
		});

		reintentarbtn.addEventListener('click', function(){
			preview.classList.add('hidden');
			pictureContainer.classList.remove('hidden');
		});

		navigator.mediaDevices.getUserMedia(
		{
			video: {
				facingMode: "environment"
			}
		})
		.then(handleSuccess);
	</script>
</body>
</html>